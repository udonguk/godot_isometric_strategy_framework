# 제품 요구사항 정의서 (PRD - Product Requirements Document)

## 1. 개요 (Overview)
이 문서는 "Isometric Strategy Framework"의 핵심 기능과 기술 요구사항을 정의합니다.

**목적**: 타이쿤/RTS 스타일 게임을 빠르게 제작할 수 있는 재사용 가능한 베이스 프레임워크 제공

## 2. 핵심 기능 리스트 (Core Features)

### 2.1. 타일 및 맵 시스템 (Tile & Map System)

#### 기능 요구사항
- [x] **그리드 시스템**: Diamond Right 아이소메트릭 좌표 변환
- [x] **좌표 변환**: 그리드 ↔ 월드 좌표 양방향 변환
- [x] **좌표 검증**: 맵 범위 내 유효성 체크
- [x] **UI/Logic 분리**: 텍스처 크기에 독립적인 로직

#### 기술 요구사항
- Godot TileMapLayer + TileSet 사용
- GridSystem (Autoload 싱글톤)
- GameConfig에서 타일 크기 상수 관리

#### 완료 기준
- ✅ 그리드 좌표 (x, y)를 월드 좌표로 정확히 변환
- ✅ 클릭 위치를 그리드 좌표로 정확히 역변환
- ✅ 텍스처 크기 변경 시 로직 수정 불필요

---

### 2.2. 건물 시스템 (Building System)

#### 기능 요구사항
- [x] **건물 배치**: 그리드 좌표에 정확히 배치
- [x] **건물 관리**: 생성/제거/조회 (BuildingManager)
- [x] **상태 시각화**: 건물 상태별 색상/외곽선 표시
- [x] **클릭 감지**: 건물 선택 및 정보 표시
- [ ] **건물 철거**: 배치된 건물 제거
- [ ] **건설 진행도**: 건설 중 상태 시각화
- [ ] **업그레이드**: 건물 레벨업 기능

#### 기술 요구사항
- BuildingEntity 씬 (extends Node2D)
- BuildingManager (건물 목록 관리)
- Dictionary 기반 그리드 매핑 (Vector2i → BuildingEntity)
- GameConfig에서 건물 설정 관리

#### 완료 기준
- ✅ 그리드 (x, y)에 건물 정확히 배치
- ✅ 동일 위치 중복 배치 방지
- ✅ 클릭 시 건물 선택 및 외곽선 표시
- [ ] 건물 철거 시 Navigation 메쉬 복구

---

### 2.3. Navigation 시스템 (Pathfinding & Navigation)

#### 기능 요구사항
- [x] **Navigation 기반**: NavigationServer2D + TileMapLayer 통합
- [x] **좌표 검증**: Navigation 가능 영역 체크
- [x] **장애물 등록**: 건물 배치 시 내부 상태 관리
- [ ] **동적 장애물**: NavigationObstacle2D 통합
- [ ] **경로 재계산**: 건물 배치/철거 시 자동 업데이트
- [ ] **도달 불가 감지**: 목표 위치 도달 가능 여부 체크

#### 기술 요구사항
- NavigationServer2D (Godot 내장)
- NavigationAgent2D (유닛에 부착)
- NavigationObstacle2D (건물에 부착)
- GridSystem.is_valid_navigation_position()
- GridSystem.mark_as_obstacle()

#### 완료 기준
- ✅ TileMapLayer에 Navigation Polygon 베이크
- ✅ 그리드 좌표의 Navigation 가능 여부 검증
- [ ] 건물 주변을 우회하는 경로 생성
- [ ] 유닛이 건물 위를 지나가지 않음

---

### 2.4. 유닛 시스템 (Unit System)

#### 기능 요구사항
- [x] **유닛 생성**: UnitEntity 씬 인스턴스화
- [x] **기본 이동**: NavigationAgent2D 기반 경로 찾기
- [ ] **유닛 선택**: 단일/다중 선택 (Ctrl+클릭)
- [ ] **이동 명령**: 우클릭으로 목표 지점 이동
- [ ] **충돌 회피**: 유닛 간 RVO (Local Avoidance)
- [ ] **Stuck 감지**: 갇힌 유닛 자동 탈출
- [ ] **유닛 정보**: HP, 상태, 스킬 등 (추후 확장)

#### 기술 요구사항
- UnitEntity 씬 (extends CharacterBody2D)
- NavigationAgent2D (경로 찾기)
- CollisionShape2D (물리 충돌)
- SelectionManager (Autoload 싱글톤)
- SelectionIndicator (선택 표시 스프라이트)

#### 완료 기준
- ✅ 유닛이 목표까지 자동으로 이동
- [ ] 클릭으로 유닛 선택, 외곽선 표시
- [ ] Ctrl+클릭으로 여러 유닛 선택
- [ ] 우클릭으로 선택된 유닛들 이동
- [ ] 좁은 통로에서 유닛 간 충돌 없이 통과

---

### 2.5. 카메라 시스템 (Camera System)

#### 기능 요구사항
- [x] **WASD 이동**: 키보드로 카메라 이동
- [x] **부드러운 이동**: 프레임 독립적 움직임
- [ ] **엣지 스크롤**: 마우스를 화면 가장자리로 이동 시 카메라 스크롤
- [ ] **줌 인/아웃**: 마우스 휠로 줌 조절
- [ ] **맵 경계 제한**: 카메라가 맵 밖으로 나가지 않음

#### 기술 요구사항
- RtsCamera2D 씬 (extends Camera2D)
- Input.is_action_pressed() 사용
- GameConfig에서 카메라 속도 설정

#### 완료 기준
- ✅ WASD로 부드럽게 이동
- [ ] 마우스 엣지 스크롤 동작
- [ ] 줌 레벨 제한 (min: 0.5, max: 2.0)
- [ ] 맵 경계 밖으로 이동 불가

---

### 2.6. 입력 처리 시스템 (Input System)

#### 기능 요구사항
- [x] **Entity 클릭 감지**: 건물/유닛 개별 클릭 처리
- [x] **빈 공간 클릭**: 그리드 좌표 출력
- [ ] **우클릭 명령**: 선택된 유닛 이동 지시
- [ ] **드래그 선택**: 박스 드래그로 다중 선택
- [ ] **단축키**: 건물 건설, 유닛 생산 등

#### 기술 요구사항
- _input_event() (Entity별 클릭)
- _unhandled_input() (빈 공간 클릭)
- Input Actions (프로젝트 설정)

#### 완료 기준
- ✅ 건물 클릭 시 선택 표시
- ✅ 빈 공간 클릭 시 그리드 좌표 출력
- [ ] 우클릭으로 유닛 이동
- [ ] 드래그 박스 선택 UI 표시

---

### 2.7. 설정 시스템 (Configuration System)

#### 기능 요구사항
- [x] **중앙 집중 관리**: 모든 설정을 GameConfig에서 관리
- [x] **타입별 분류**: 타일, 건물, 유닛, 맵, Navigation 설정 분리
- [x] **상수 기반**: 매직 넘버 제거
- [x] **타입 안정성**: 타입 힌트 사용

#### 기술 요구사항
- GameConfig (Autoload 싱글톤)
- const 키워드 사용
- 섹션별 주석 구분

#### 완료 기준
- ✅ 모든 설정이 GameConfig에 존재
- ✅ 코드에 매직 넘버 없음
- ✅ 설정 변경 시 한 곳만 수정

---

### 2.8. UI 시스템 (UI System) - 추후 구현

#### 기능 요구사항
- [ ] **HUD**: 자원, 인구, 시간 표시
- [ ] **미니맵**: 맵 전체 축소 뷰 + 카메라 위치 표시
- [ ] **건물 선택 UI**: 건물 정보 패널
- [ ] **유닛 정보 패널**: HP, 상태, 스킬
- [ ] **건설 메뉴**: 건물 목록 및 선택
- [ ] **메뉴 시스템**: 타이틀, 일시정지, 설정

#### 기술 요구사항
- Control 노드 기반 UI
- CanvasLayer (UI 레이어 분리)
- Theme 리소스 (일관된 스타일)

---

### 2.9. 자원 시스템 (Resource System) - 추후 구현

#### 기능 요구사항
- [ ] **자원 타입**: 나무, 돌, 식량, 골드 등
- [ ] **자원 수집**: 유닛이 자원 지점에서 수집
- [ ] **자원 소비**: 건물 건설, 유닛 생산 비용
- [ ] **자원 저장**: 창고 건물, 저장 한계
- [ ] **자원 UI**: HUD에 현재 자원량 표시

#### 기술 요구사항
- ResourceManager (Autoload)
- Dictionary 기반 자원 관리
- Signal로 자원 변경 이벤트 전파

---

## 3. 우선순위 (Priorities)

### P0 (필수 구현 - MVP)
현재 프레임워크의 최소 기능

- ✅ 타일 시스템 (좌표 변환)
- ✅ 건물 시스템 (배치, 선택)
- ✅ Navigation 기반 구축
- ✅ 유닛 기본 이동
- ✅ RTS 카메라
- [ ] **유닛 선택 시스템** ← 다음 우선순위
- [ ] **이동 명령 처리** ← 다음 우선순위

### P1 (중요 - 프레임워크 완성도)
프레임워크를 실제로 사용 가능하게 만드는 기능

- [ ] 건물 NavigationObstacle2D 통합
- [ ] 유닛 간 충돌 회피
- [ ] 드래그 박스 선택
- [ ] 건물 철거 기능
- [ ] 카메라 엣지 스크롤, 줌
- [ ] 맵 경계 제한

### P2 (추가 기능 - 확장성)
게임 제작 시 필요한 추가 기능

- [ ] 자원 시스템
- [ ] UI 시스템 (HUD, 미니맵)
- [ ] 건설 진행도 표시
- [ ] 유닛 정보 패널
- [ ] 건물 업그레이드

### P3 (고급 기능 - 선택사항)
특정 장르에만 필요한 고급 기능

- [ ] 유닛 AI (patrol, attack)
- [ ] 전투 시스템
- [ ] 포그 오브 워
- [ ] 유닛 스킬 시스템
- [ ] 멀티플레이어 (추후 고려)

---

## 4. 비기능 요구사항 (Non-Functional Requirements)

### 4.1. 성능 (Performance)
- **목표 FPS**: 60 FPS 유지
- **유닛 수**: 최소 50개 동시 이동 지원
- **건물 수**: 최소 100개 건물 배치 지원
- **맵 크기**: 100x100 타일 이상

### 4.2. 코드 품질 (Code Quality)
- **SOLID 원칙**: 모든 매니저/시스템 준수
- **타입 안정성**: 모든 함수에 타입 힌트
- **주석**: 복잡한 로직에 한국어 주석
- **문서화**: 각 시스템별 설계 문서 존재

### 4.3. 유지보수성 (Maintainability)
- **설정 분리**: GameConfig 중앙 관리
- **UI/Logic 분리**: 비주얼 변경이 로직에 영향 없음
- **모듈화**: 각 시스템 독립적 동작 가능
- **확장성**: 새 기능 추가 시 기존 코드 최소 수정

### 4.4. 재사용성 (Reusability)
- **씬 기반**: 모든 엔티티는 재사용 가능한 씬
- **범용 설계**: 특정 게임에 종속되지 않음
- **예제 제공**: test_map.tscn으로 사용법 제시

---

## 5. 제약 사항 (Constraints)

### 5.1. 기술 제약
- **엔진**: Godot 4.5 이상 필수
- **플랫폼**: PC (Windows) 우선 지원
- **언어**: GDScript (C# 미지원)
- **2D 전용**: 3D는 고려하지 않음

### 5.2. 디자인 제약
- **아이소메트릭**: Diamond Right 방식 고정
- **그리드 기반**: 모든 배치는 그리드 단위
- **실시간**: 턴제는 부분 지원 (일부 수정 필요)

### 5.3. 범위 제약
- **네트워크**: 멀티플레이어 미지원 (추후 고려)
- **세이브/로드**: 현재 버전 미지원
- **모바일**: PC 전용 (터치 미지원)

---

## 6. 성공 지표 (Success Metrics)

### 6.1. 개발자 경험
- **새 게임 제작 시간**: 기본 맵 + 건물 배치 < 1시간
- **학습 곡선**: README + 문서 읽고 사용 가능
- **코드 재사용률**: 80% 이상 코드 재사용

### 6.2. 기술 지표
- **테스트 시나리오 통과율**: 100%
- **FPS**: 유닛 50개 + 건물 100개 환경에서 60 FPS
- **버그**: Critical 버그 0개

---

## 7. 출시 기준 (Release Criteria)

### Alpha (현재 목표)
- [x] 타일 시스템 동작
- [x] 건물 배치/선택 동작
- [x] 유닛 기본 이동 동작
- [ ] 유닛 선택/이동 명령 동작
- [ ] test_map.tscn 예제 완성

### Beta (다음 목표)
- [ ] Navigation 장애물 통합
- [ ] UI 시스템 기초 (HUD)
- [ ] 자원 시스템 기초
- [ ] 문서 완성 (framework_architecture.md)

### 1.0 Release
- [ ] 모든 P0, P1 기능 구현
- [ ] 전체 테스트 시나리오 통과
- [ ] 예제 게임 1개 제작 가능
- [ ] 사용 가이드 문서 완성

---

## 8. 참고 문서 (References)

- **game_design.md**: 프레임워크 전체 개요
- **backlog.md**: 개발 진행 상황 및 백로그
- **framework_architecture.md**: 아키텍처 상세 설명
- **code_convention.md**: 코드 작성 규칙
- **design/**: 시스템별 설계 문서
